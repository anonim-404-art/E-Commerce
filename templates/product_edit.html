{% extends "base.html" %} {% block content %}
<div class="max-w-4xl mx-auto px-6 py-16">
  <div class="mb-12 flex items-center justify-between">
    <div>
      <h2 class="text-4xl font-[900] tracking-tighter text-slate-900 italic">
        Edit Product<span class="text-indigo-600">.</span>
      </h2>
      <p class="text-slate-500 mt-2 font-medium">
        Update details for:
        <span id="product-name" class="text-slate-900 font-bold"></span>
      </p>
    </div>
    <a
      href="/product"
      class="text-xs font-black uppercase tracking-widest text-slate-400 hover:text-indigo-600 transition"
      >&larr; Back to Inventory</a
    >
  </div>

  <div
    class="bg-white rounded-[3rem] shadow-2xl shadow-slate-200/50 border border-slate-100 overflow-hidden"
  >
    <form
      id="edit-form"
      method="POST"
      enctype="multipart/form-data"
      class="p-10 lg:p-16 space-y-8"
    >
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="space-y-2">
          <label
            class="text-[10px] font-bold uppercase tracking-widest text-slate-400 ml-1"
            >Product Name</label
          >
          <input
            id="input-name"
            type="text"
            name="name"
            required
            class="w-full px-6 py-4 rounded-2xl bg-slate-50 border-transparent focus:bg-white focus:ring-4 focus:ring-indigo-500/10 focus:border-indigo-600 outline-none transition-all"
          />
        </div>
        <div class="space-y-2">
          <label
            class="text-[10px] font-bold uppercase tracking-widest text-slate-400 ml-1"
            >Brand</label
          >
          <input
            type="text"
            name="brand"
            id="input-brand"
            required
            class="w-full px-6 py-4 rounded-2xl bg-slate-50 border-transparent focus:bg-white focus:ring-4 focus:ring-indigo-500/10 focus:border-indigo-600 outline-none transition-all"
          />
        </div>
      </div>
      <div class="space-y-2">
        <label
          class="text-[10px] font-bold uppercase tracking-widest text-slate-400 ml-1"
        >
          Product Color
        </label>
        <div
          class="relative flex items-center bg-slate-50 rounded-2xl p-1 focus-within:bg-white focus-within:ring-4 focus-within:ring-indigo-500/10 transition-all border border-transparent focus-within:border-indigo-600"
        >
          <input
            type="color"
            name="color"
            id="input-color"
            class="w-14 h-12 bg-transparent border-none cursor-pointer rounded-xl [&::-webkit-color-swatch-wrapper]:p-1 [&::-webkit-color-swatch]:rounded-lg [&::-webkit-color-swatch]:border-none"
          />

          <input
            type="text"
            id="hex-display"
            readonly
            class="bg-transparent border-none text-slate-900 text-sm font-medium ml-2 outline-none flex-1 pointer-events-none"
          />
        </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div class="space-y-2">
          <label
            class="text-[10px] font-bold uppercase tracking-widest text-slate-400 ml-1"
            >Price ($)</label
          >
          <input
            id="input-price"
            type="number"
            step="0.01"
            name="price"
            required
            class="w-full px-6 py-4 rounded-2xl bg-slate-50 border-transparent focus:bg-white focus:ring-4 focus:ring-indigo-500/10 focus:border-indigo-600 outline-none transition-all"
          />
        </div>
        <div class="space-y-2">
          <label
            class="text-[10px] font-bold uppercase tracking-widest text-slate-400 ml-1"
            >Stock Qty</label
          >
          <input
            type="number"
            name="quantity"
            id="input-quantity"
            required
            class="w-full px-6 py-4 rounded-2xl bg-slate-50 border-transparent focus:bg-white focus:ring-4 focus:ring-indigo-500/10 focus:border-indigo-600 outline-none transition-all"
          />
        </div>
        <div class="space-y-2">
          <label
            class="text-[10px] font-bold uppercase tracking-widest text-slate-400 ml-1"
            >Category</label
          >
          <select
            name="category"
            class="w-full px-6 py-4 rounded-2xl bg-slate-50 border-transparent focus:bg-white focus:ring-4 focus:ring-indigo-500/10 focus:border-indigo-600 outline-none transition-all appearance-none"
          >
            <option value="tops">Tops & Tees</option>
            <option value="outerwear">Outerwear</option>
            <option value="bottoms">Bottoms</option>
            <option value="dresses">Dresses</option>
            <option value="sneakers">Sneakers</option>
            <option value="formal_shoes">Formal Shoes</option>
            <option value="bags">Bags & Luggage</option>
            <option value="watches">Watches</option>
            <option value="jewelry">Jewelry</option>
          </select>
        </div>
      </div>

      <div class="space-y-2">
        <label
          class="text-[10px] font-bold uppercase tracking-widest text-slate-400 ml-1"
          >Description</label
        >
        <textarea
          name="description"
          rows="4"
          id="input-desc"
          class="w-full px-6 py-4 rounded-2xl bg-slate-50 border-transparent focus:bg-white focus:ring-4 focus:ring-indigo-500/10 focus:border-indigo-600 outline-none transition-all"
        ></textarea>
      </div>

      <div class="pt-8 border-t border-slate-100">
        <h3
          class="text-[11px] font-black uppercase tracking-[0.2em] text-slate-900 mb-6"
        >
          Update Visuals
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-1">
            <label class="text-[9px] font-black uppercase text-slate-400 ml-2"
              >Main Front Image</label
            >
            <input
              type="file"
              name="image"
              class="block w-full text-xs text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-[10px] file:font-black file:uppercase file:bg-indigo-50 file:text-indigo-600"
            />
          </div>
          <div class="space-y-1">
            <label class="text-[9px] font-black uppercase text-slate-400 ml-2"
              >Back View</label
            >
            <input
              type="file"
              name="back_image"
              class="block w-full text-xs text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-[10px] file:font-black file:uppercase file:bg-slate-50 file:text-slate-600"
            />
          </div>
          <div class="space-y-1">
            <label class="text-[9px] font-black uppercase text-slate-400 ml-2"
              >Detail/Just View</label
            >
            <input
              type="file"
              name="just_image"
              class="block w-full text-xs text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-[10px] file:font-black file:uppercase file:bg-slate-50 file:text-slate-600"
            />
          </div>
          <div class="space-y-1">
            <label class="text-[9px] font-black uppercase text-slate-400 ml-2"
              >Side View</label
            >
            <input
              type="file"
              name="side_image"
              class="block w-full text-xs text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-[10px] file:font-black file:uppercase file:bg-slate-50 file:text-slate-600"
            />
          </div>
          <div class="space-y-1">
            <label class="text-[9px] font-black uppercase text-slate-400 ml-2"
              >Bottom View</label
            >
            <input
              type="file"
              name="bottom_image"
              class="block w-full text-xs text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-[10px] file:font-black file:uppercase file:bg-slate-50 file:text-slate-600"
            />
          </div>
          <span
            class="text-slate-500 mt-2 font-medium col-span-full block text-center"
            >You can leave any image field blank if you don't want to update
            it.</span
          >
        </div>
      </div>

      <button
        type="submit"
        class="w-full bg-slate-900 text-white py-6 rounded-2xl font-bold hover:bg-indigo-600 transition-all shadow-xl shadow-indigo-100 transform active:scale-[0.98]"
      >
        Save Changes
      </button>
    </form>
  </div>
</div>
<script>
  const colorInput = document.querySelector('input[type="color"]');
  const hexDisplay = document.querySelector("#hex-display");

  colorInput.addEventListener("input", (e) => {
    hexDisplay.value = e.target.value.toUpperCase();
  });
  const productId = window.location.pathname.split("/").pop();

  fetch(`/api/single_product/${productId}`)
    .then((res) => res.json())
    .then((product) => {
      const productName = document.getElementById("product-name");
      const editForm = document.getElementById("edit-form");
      const inputName = document.getElementById("input-name");
      const inputBrand = document.getElementById("input-brand");
      const inputColor = document.getElementById("input-color");
      const inputPrice = document.getElementById("input-price");
      const inputQuantity = document.getElementById("input-quantity");
      const inputDesc = document.getElementById("input-desc");
      if (product.error) {
        window.location.href = "/product";
        return;
      }
      if (product.colors && product.colors.length > 0) {
        inputColor.value = product.colors[0];
        hexDisplay.value = product.colors[0].toUpperCase();
      } else {
        inputColor.value = "#6366f1";
        hexDisplay.value = "#6366F1";
      }
      editForm.action = `/product_edit/${product.id}`;
      inputName.value = product.name;
      productName.innerText = product.name;
      inputBrand.value = product.brand;
      inputPrice.value = product.price;
      inputQuantity.value = product.quantity;
      inputDesc.value = product.description;
    });
</script>
{% endblock %}
