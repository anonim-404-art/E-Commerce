{% extends "base.html" %} {% block content %}
<div class="max-w-7xl mx-auto px-6 py-12">
  <div class="flex flex-col md:flex-row justify-between items-end mb-16 gap-8">
    <div>
      <nav class="flex space-x-2 text-[10px] font-bold uppercase tracking-[0.2em] text-slate-400 mb-4">
        <a href="/" class="hover:text-indigo-600">Home</a>
        <span>/</span>
        <span class="text-slate-900">Shop All</span>
      </nav>
      <h1 class="text-5xl font-[900] tracking-tighter text-slate-900 italic">
        The Collections<span class="text-indigo-600">.</span>
      </h1>
    </div>
    <p class="text-slate-500 font-medium max-w-xs text-right hidden md:block italic">
      Carefully curated pieces designed for the modern minimalist.
    </p>
  </div>

  <div class="flex flex-col lg:flex-row gap-16">
    <aside class="w-full lg:w-72 space-y-12">

      <div class="space-y-10">

        <div>
          <h3
            class="text-[11px] font-black uppercase tracking-[0.2em] text-slate-900 mb-6 border-b border-slate-100 pb-2">
            Category</h3>
          <div class="space-y-3">
            <label class="flex items-center group cursor-pointer">
              <input type="radio" name="category" value="all" class="hidden peer" checked>
              <span
                class="w-4 h-4 border-2 border-slate-200 rounded-full mr-3 peer-checked:border-indigo-600 peer-checked:bg-indigo-600 transition-all"></span>
              <span
                class="text-sm font-semibold text-slate-500 group-hover:text-indigo-600 transition-colors capitalize">All</span>
            </label>
            <label class="flex items-center group cursor-pointer">
              <input type="radio" name="category" value="tops" class="hidden peer">
              <span
                class="w-4 h-4 border-2 border-slate-200 rounded-full mr-3 peer-checked:border-indigo-600 peer-checked:bg-indigo-600 transition-all"></span>
              <span
                class="text-sm font-semibold text-slate-500 group-hover:text-indigo-600 transition-colors capitalize">Tops</span>
            </label>
            <label class="flex items-center group cursor-pointer">
              <input type="radio" name="category" value="outerwear" class="hidden peer">
              <span
                class="w-4 h-4 border-2 border-slate-200 rounded-full mr-3 peer-checked:border-indigo-600 peer-checked:bg-indigo-600 transition-all"></span>
              <span
                class="text-sm font-semibold text-slate-500 group-hover:text-indigo-600 transition-colors capitalize">Outerwear</span>
            </label>
            <label class="flex items-center group cursor-pointer">
              <input type="radio" name="category" value="bottoms" class="hidden peer">
              <span
                class="w-4 h-4 border-2 border-slate-200 rounded-full mr-3 peer-checked:border-indigo-600 peer-checked:bg-indigo-600 transition-all"></span>
              <span
                class="text-sm font-semibold text-slate-500 group-hover:text-indigo-600 transition-colors capitalize">Bottoms</span>
            </label>
            <label class="flex items-center group cursor-pointer">
              <input type="radio" name="category" value="dresses" class="hidden peer">
              <span
                class="w-4 h-4 border-2 border-slate-200 rounded-full mr-3 peer-checked:border-indigo-600 peer-checked:bg-indigo-600 transition-all"></span>
              <span
                class="text-sm font-semibold text-slate-500 group-hover:text-indigo-600 transition-colors capitalize">Dresses</span>
            </label>
            <label class="flex items-center group cursor-pointer">
              <input type="radio" name="category" value="sneakers" class="hidden peer">
              <span
                class="w-4 h-4 border-2 border-slate-200 rounded-full mr-3 peer-checked:border-indigo-600 peer-checked:bg-indigo-600 transition-all"></span>
              <span
                class="text-sm font-semibold text-slate-500 group-hover:text-indigo-600 transition-colors capitalize">Sneakers</span>
            </label>
            <label class="flex items-center group cursor-pointer">
              <input type="radio" name="category" value="formal_shoes" class="hidden peer">
              <span
                class="w-4 h-4 border-2 border-slate-200 rounded-full mr-3 peer-checked:border-indigo-600 peer-checked:bg-indigo-600 transition-all"></span>
              <span
                class="text-sm font-semibold text-slate-500 group-hover:text-indigo-600 transition-colors capitalize">Formal
                Shoes</span>
            </label>
            <label class="flex items-center group cursor-pointer">
              <input type="radio" name="category" value="bags" class="hidden peer">
              <span
                class="w-4 h-4 border-2 border-slate-200 rounded-full mr-3 peer-checked:border-indigo-600 peer-checked:bg-indigo-600 transition-all"></span>
              <span
                class="text-sm font-semibold text-slate-500 group-hover:text-indigo-600 transition-colors capitalize">Bags</span>
            </label>
            <label class="flex items-center group cursor-pointer">
              <input type="radio" name="category" value="watches" class="hidden peer">
              <span
                class="w-4 h-4 border-2 border-slate-200 rounded-full mr-3 peer-checked:border-indigo-600 peer-checked:bg-indigo-600 transition-all"></span>
              <span
                class="text-sm font-semibold text-slate-500 group-hover:text-indigo-600 transition-colors capitalize">Watches</span>
            </label>
            <label class="flex items-center group cursor-pointer">
              <input type="radio" name="category" value="jewelry" class="hidden peer">
              <span
                class="w-4 h-4 border-2 border-slate-200 rounded-full mr-3 peer-checked:border-indigo-600 peer-checked:bg-indigo-600 transition-all"></span>
              <span
                class="text-sm font-semibold text-slate-500 group-hover:text-indigo-600 transition-colors capitalize">Jewelry</span>
            </label>
          </div>
        </div>

        <div>
          <h3
            class="text-[11px] font-black uppercase tracking-[0.2em] text-slate-900 mb-6 border-b border-slate-100 pb-2">
            Price Range</h3>
          <select id="price-select"
            class="w-full bg-slate-50 border-none rounded-xl px-4 py-3 text-sm font-bold text-slate-700 outline-none focus:ring-2 focus:ring-indigo-500/20">
            <option value="all">Any Price</option>
            <option value="f1">Under $100</option>
            <option value="f2">$101 - $200</option>
            <option value="f3">$201 - $300</option>
            <option value="f4">$301 - $400</option>
            <option value="f5">$401 - $500</option>
            <option value="f6">$501+</option>
          </select>
        </div>

        <button onclick="filterProducts()"
          class="w-full py-4 bg-slate-900 text-white rounded-2xl font-bold text-xs uppercase tracking-widest hover:bg-indigo-600 transition-all shadow-xl shadow-indigo-100">
          Apply Filters
        </button>
      </div>
    </aside>

    <div class="flex-1">
      <div class="h-[80vh] overflow-y-auto pr-4 custom-scrollbar">
        <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-x-8 gap-y-16">
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  let allProducts = [];
  let wishlistIds = [];

  fetch('/api/shop')
    .then(res => res.json())
    .then(data => {
      allProducts = data.products;
      wishlistIds = data.wishlist_product_ids;
      render(allProducts);
    });

  function filterProducts() {
    const selectedCat = document.querySelector('input[name="category"]:checked').value;
    const selectedPrice = document.getElementById('price-select').value;

    const filtered = allProducts.filter(item => {
      const matchCat = (selectedCat === 'all') || (item.category === selectedCat);

      let matchPrice = false;
      if (selectedPrice === 'all') matchPrice = true;
      else if (selectedPrice === 'f1') matchPrice = item.price <= 100;
      else if (selectedPrice === 'f2') matchPrice = item.price > 100 && item.price <= 200;
      else if (selectedPrice === 'f3') matchPrice = item.price > 200 && item.price <= 300;
      else if (selectedPrice === 'f4') matchPrice = item.price > 300 && item.price <= 400;
      else if (selectedPrice === 'f5') matchPrice = item.price > 400 && item.price <= 500;
      else if (selectedPrice === 'f6') matchPrice = item.price > 500;

      return matchCat && matchPrice;
    });

    render(filtered);
  }
  function render(items) {
    const container = document.getElementById('product-grid');
    container.innerHTML = '';

    if (items.length === 0) {
      container.innerHTML = '<p class="text-slate-400 font-bold">No products found.</p>';
      return;
    }

    items.forEach(item => {
      const isWishlisted = wishlistIds.includes(item.id);

      container.innerHTML += `
        <div class="group relative">
          <div class="relative aspect-[3/4] rounded-[2.5rem] overflow-hidden bg-slate-100">
            <img src="${item.images}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110" />
            
            <div class="absolute top-6 right-6">
              <a href="${isWishlisted ? '/wishlist_delete/' : '/wishlist_product/'}${item.id}" 
                 class="p-3 bg-white rounded-2xl shadow-xl block hover:scale-110 transition ${isWishlisted ? 'text-indigo-600' : 'text-slate-400'}">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="${isWishlisted ? 'currentColor' : 'none'}" stroke="currentColor">
                  <path d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" />
                </svg>
              </a>
            </div>

            <div class="absolute inset-x-6 bottom-6 translate-y-4 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 transition-all duration-300">
              <a onclick="getData(${item.id})" class="w-full bg-white/95 backdrop-blur-sm py-4 rounded-2xl font-bold text-center text-[11px] uppercase tracking-widest text-slate-900 shadow-2xl block hover:bg-slate-900 hover:text-white transition cursor-pointer">
                View Details
              </a>
            </div>
          </div>

          <div class="mt-8 px-2 flex justify-between items-start">
            <div>
              <span class="text-[9px] font-black text-indigo-600 uppercase tracking-[0.2em]">${item.category}</span>
              <h3 class="text-lg font-bold text-slate-900 tracking-tight mt-1">${item.name}</h3>
              <p class="text-xs text-slate-400 font-medium">${item.brand}</p>
            </div>
            <p class="text-xl font-black text-slate-900">$${item.price}</p>
          </div>
        </div>
      `;
    });
  }

  function getData(productId) {
    window.location.href = "/single_product/" + productId;
  }
</script>
{% endblock %}